name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install ShellCheck
        run: sudo apt-get install -y shellcheck

      - name: Lint shell scripts
        run: |
          shopt -s globstar nullglob
          scripts=(*.sh **/*.sh)
          if [ ${#scripts[@]} -eq 0 ]; then
            echo "No shell scripts found to lint"
          else
            shellcheck "${scripts[@]}"
          fi

      - name: Validate JSON files
        run: |
          shopt -s globstar nullglob
          json_files=(*.json **/*.json)
          if [ ${#json_files[@]} -eq 0 ]; then
            echo "No JSON files found to validate"
          else
            for f in "${json_files[@]}"; do
              echo "Validating $f"
              python3 -m json.tool "$f" > /dev/null
            done
          fi
