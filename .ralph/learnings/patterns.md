# Learnings: patterns

- [Story 2.2] When extracting a phase from a monolith, the key changes are surgical: (1) replace inline pattern content with a reference to the shared library file, (2) update cross-references in sub-agent dispatch instructions (e.g., \"copy the patterns section below\" → \"read patterns/secrets.md\"), and (3) add a structured header block (Phase, Name, Inputs, Outputs) plus an orchestrator note on the user gate. The bulk of the content (steps, classification rules, remediation types, formats) should be extracted verbatim to avoid introducing subtle differences between the monolith and the decomposed version.
- [Story 2.2] When extracting a phase from a monolith, the key changes are surgical: (1) replace inline pattern content with a reference to the shared library file, (2) update cross-references in sub-agent dispatch instructions (e.g., "copy the patterns section below" → "read patterns/secrets.md"), and (3) add a structured header block (Phase, Name, Inputs, Outputs) plus an orchestrator note on the user gate. The bulk of the content (steps, classification rules, remediation types, formats) should be extracted verbatim to avoid introducing subtle differences between the monolith and the decomposed version.
- [Story 2.4] When extracting a phase that has a design bug requiring orchestrator-side pre-checks (like the license selection preamble in Phase 3), clearly mark the boundary between orchestrator and sub-agent responsibilities using an architectural note at the top of the pre-check step. The DD-4 constraint (sub-agents cannot interact with users) means any user-interactive steps must be documented as orchestrator-side work that passes results as inputs to the sub-agent. This pattern — orchestrator resolves interactive input, then passes it as a typed input to the sub-agent — will recur in any phase that needs user decisions before sub-agent execution.
- [Story 2.4] When extracting a phase that has a design bug requiring orchestrator-side pre-checks (like the license selection preamble in Phase 3), clearly mark the boundary between orchestrator and sub-agent responsibilities using an architectural note at the top of the pre-check step. The DD-4 constraint (sub-agents cannot interact with users) means any user-interactive steps must be documented as orchestrator-side work that passes results as inputs to the sub-agent. This pattern — orchestrator resolves interactive input, then passes it as a typed input to the sub-agent — will recur in any phase that needs user decisions before sub-agent execution.
- [Story 2.10] Phase 9 is unique among all extraction stories because it produces NO new findings — it's purely a synthesis/aggregation phase. The extraction pattern still works well: header block with I/O, steps, finding format, user gate. But for aggregation phases, the \"Finding Format\" section should document how existing findings are classified (status labels) rather than how new findings are generated. The orchestrator note pattern (sub-agent returns data, orchestrator presents to user) is important to preserve for phases that have user-facing presentation variants.
- [Story 2.10] Phase 9 is unique among all extraction stories because it produces NO new findings — it's purely a synthesis/aggregation phase. The extraction pattern still works well: header block with I/O, steps, finding format, user gate. But for aggregation phases, the "Finding Format" section should document how existing findings are classified (status labels) rather than how new findings are generated. The orchestrator note pattern (sub-agent returns data, orchestrator presents to user) is important to preserve for phases that have user-facing presentation variants.
